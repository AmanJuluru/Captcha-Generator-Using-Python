{% extends "base.html" %}

{% block title %}Register{% endblock %}

{% block content %}
    <h2>New User Registration</h2>
    
    <form method="POST" action="{{ url_for('register') }}">
        <div class="form-group">
            <label for="username">Username:</label>
            <input type="text" id="username" name="username" required>
        </div>
        <div class="form-group">
            <label for="password">Password:</label>
            <input type="password" id="password" name="password" required>
        </div>
        
        <h3>CAPTCHA Verification</h3>
        <div class="captcha-box">
            <img id="captchaImage" src="{{ captcha_image }}" alt="CAPTCHA Image">
            <button type="button" onclick="refreshCaptcha()" class="button secondary">Refresh</button>
        </div>
        
        <div class="form-group">
            <label for="captcha_input">Enter CAPTCHA Text:</label>
            <input type="text" id="captcha_input" name="captcha_input" required>
        </div>

        <button type="submit" class="button primary">Register & Verify</button>
    </form>

    <script>
        function refreshCaptcha() {
            // Sends a request to the /refresh_captcha endpoint to generate a new image
            fetch('{{ url_for('refresh_captcha') }}')
                .then(response => response.text())
                .then(newImageUrl => {
                    // Updates the image source with the new URL
                    document.getElementById('captchaImage').src = newImageUrl;
                })
                .catch(error => console.error('Error refreshing CAPTCHA:', error));
        }
    </script>
{% endblock %}